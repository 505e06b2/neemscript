<html>
<head>
<meta charset="utf8">
<script src="neemscript.js"></script>
<script>
var outbox;
var inbox;
var interpret;

function runcode() {
	if(interpret === undefined) {
		alert('Can\'t load Neemscript... Try refreshing');
		return;
	}
	interpret(input.value);
	inbox.focus();
}

window.onload = function() {
	outbox = document.getElementById('output');
	inbox = document.getElementById('input');
	inbox.focus();
	inbox.onkeydown = function(e) {
		if(e.keyCode == 9) { //Tab
			e.preventDefault();
			this.value += "\t";
		} else if(e.ctrlKey) {
			if(e.keyCode == 81) { //Ctrl + Q
				e.preventDefault();
				runcode();
			} else if(e.keyCode == 83) { //Ctrl + S
				e.preventDefault();
				localStorage.setItem("script", this.value);
				Module.print("[*] Saved script to localStorage");
			} else if(e.keyCode == 79) { //Ctrl + O
				e.preventDefault();
				this.value = localStorage.getItem("script");
				Module.print("[*] Loaded script from localStorage");
			} else if(e.keyCode == 87) { //Ctrl + W
				e.preventDefault();
				outbox.value = "[*] Cleared Output\n";
			}
		}
	}
	
	Module.print = function(text) {
		outbox.value += text + '\n';
		outbox.scrollTop = outbox.scrollHeight;
	};	
	Module.printErr = Module.print;
	
	Module.onRuntimeInitialized = function() {
		interpret = Module.cwrap('webmain', null, ['string']);
		console.log("Loaded Neemscript");
		var temp = localStorage.getItem("script");
		if(temp) {
			this.value = temp;
			Module.print("[*] Loaded script from localStorage");
		}
	}
};

</script>
<style>
body, textarea {
	background: #1a1a1a;
	color: #eee;
	padding:0;
	margin:0;
	font-family: monospace;
}

table {
	width:100%;
	height:100%;
}

th, .header {
	height: 30px;
	font-size: 18px;
	font-family: monospace;
}

textarea {
	resize: none;
	width: 100%;
	height: 100%;
	z-index:10;
}

a {
	color: #eee;
	text-decoration: none;
	background: #333;
	padding-top:5px;
	padding-left:5px;
	padding-right:5px;
}

#info {
	display: none;
}

#infobutton:hover~#info {
    display: block;
}

button {width:100%;}
</style>
</head>
<body>
<a id="infobutton" href="#" onclick="return false" class="header" style="position:absolute;left:5px;top:0px">?</a>
<table>
	<tr><th>Input</th><th>Output</th></tr>
	<tr><td><textarea id="input"></textarea></td><td rowspan="2"><textarea id="output" readonly style="right:0;"></textarea></td></tr>
	<tr><td style="height:15px;"><button onclick="runcode()">Run</button></td></tr>
</table>
<div id="info" style="position:absolute;left:10px;top:35px;background:#333;padding:5px;border:solid 2px #eee">
<div class="header">Shortcuts:</div>
Run Code: CTRL+Q<br>
Save Code: CTRL+S<br>
Open Code: CTRL+O<br>
Clear Output: CTRL+W
</div>
</body>
</html>